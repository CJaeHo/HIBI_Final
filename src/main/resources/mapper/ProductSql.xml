<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hibi.mapper.ProductMapperInter">

	<insert id="insertProduct" parameterType="product">
		insert into Product (loginId, productTitle, productContent, saleStatus, productStatus, 
		hidden, productLookupCount, productLikeCount, categoryIdx, productPhotos, firstImage) 
		values (#{loginId},#{productTitle},#{productContent},#{saleStatus},#{productStatus},
		#{hidden},#{productLookupCount},#{productLikeCount},#{categoryIdx},#{productPhotos},#{firstImage})
	</insert>
	<update id="updateProduct" parameterType="Product">
		update Product set productTitle=#{productTitle},productContent=#{productContent}
		<if test="photos!=null">
			,productPhotos=#{productPhotos}
			where productIdx=#{productIdx}
		</if>
	</update>
	<delete id="deleteProduct" parameterType="Long">
		delete from Product where productIdx=#{productIdx}
	</delete>
	
	
	<!-- join해서 채팅 온 수(chatRoom, count(*), where productIdx),지역(user)  가져오기 -->
	<select id="getData" parameterType="Long">
		select * from Product where productIdx=#{productIdx}
	</select>
	<update id="updateReStep" parameterType="Map">
		update Product set restep=restep+1 where reg=#{reg} and restep>#{restep}
	</update>
	<update id="updateLikeCount" parameterType="Map">
		update Product set productLikeCount=#{productLikeCount},
		<if test="productLikeCount==0">
			productLikeCount=productLikeCount-1
		</if>
			where productIdx=#{productIdx}
	</update>
	
	<!-- 대표사진 얻어오기 -->
	<select id="getFirstImage" parameterType="Long">
		select productPhotos from Product where productIdx=#{productIdx}
	</select>
	
	<!-- 조회ㅜ -->
	<update id="updateLookupCount" parameterType="Long">
		update set Product productLookupCount=productLookupCount+1 where productIdx=#{productIdx}
	</update>
	
	<!-- getList -->
	<select id="getList" parameterType="Map" resultType="board">
		select * from Product order by reg desc, restep asc limit #{start}, #{perpage}
	</select>
</mapper>